<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.4" />
<title>Jailbreaking the Forges</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Jailbreaking the Forges</h1>
<span id="author">Eric S. Raymond</span><br />
<span id="email"><tt>&lt;<a href="mailto:esr@thyrsus.com">esr@thyrsus.com</a>&gt;</tt></span><br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">Oct 2009</span>
</div>
<div id="content">
<div class="sect1">
<h2 id="_problem_statement">Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph"><p>At the beginning of October 2009, berlios.de, the hosting site on
which my GPSD project lived, went abruptly flatline after months of
deteriorating performance; I had good reason to fear that it had died
a final death. Though Berlios came back up a few days later, the
intervening process of trying to reconstruct my project data from git
mirrors and the still-accessible Mailman administrative pages rubbed
my nose in three serious design issues shared by many hosting sites
and many of their software components.</p></div>
<div class="sect2">
<h3 id="_data_jails">Data Jails</h3>
<div class="paragraph"><p>The worst problem with almost all current hosting sites is that
they&#8217;re data jails. You can put data (the source code revision
history, mailing list address lists, bug reports) into them, but
getting a complete snapshot of that data back out often ranges from
painful to impossible.</p></div>
<div class="paragraph"><p>Why is this an issue? Very practically, because hosting sites, even
well-established ones, sometimes go off the air. Any prudent project
lead should be thinking about how to recover if that happens, and how
to take periodic backups of critical project data.  But more generally,
it&#8217;s <strong>your data</strong>.  You should own it.  If you can&#8217;t push a button and
get a snapshot of your project state out of the site whenever you
want, you <strong>don&#8217;t</strong> own it.</p></div>
<div class="paragraph"><p>When berlios.de crashed on me, I was lucky; I had been preparing to
migrate GPSD off the site due to deteriorating performance; I had
a Subversion dump file that was less than two weeks old.  I was
able to bring that up to date by translating commits from an
unofficial git mirror. I was doubly lucky in that the Mailman
adminstrative pages remained accessible even when the project
webspace and repositories had been 404 for two days.</p></div>
<div class="paragraph"><p>But actually retrieving my mailing-list data was a hideous process
that involved screen-scraping HTML by hand, and I had no hope at all
of retrieving the bug tracker state.</p></div>
<div class="paragraph"><p>This anecdote illustrates the most serious manifestations of the
data-jail problem.  Third-generation version-control (hg, git, bzr,
etc.) systems pretty much solve it for code repositories; every
checkout is a mirror.  But most projects have two other critical data
collections: their mailing-list state and their bug-tracker state.
And, on all sites I know of in late 2009, those are seriously jailed.</p></div>
<div class="paragraph"><p>This is a problem that goes straight to the design of the software
subsystems used by these sites.  Some are generic: of these, the most
frequent single offender is 2.x versions of Mailman, the most widely
used mailing-list manager (the Mailman maintainers claim to have fixed
this in 3.0). Bug-trackers tend to be tightly tied to individual
hosting engines, and are even harder to dig data out of.  They also
illustrate the second major failing&#8230;</p></div>
</div>
<div class="sect2">
<h3 id="_unscriptability">Unscriptability</h3>
<div class="paragraph"><p>All hosting-site suites are Web-centric, operated primarily or
entirely through a browser.  This solves many problems, but creates a
few as well.  One is that browsers, like GUIs in general, are badly
suited for stereotyped and repetitive tasks.  Another is that they
have poor accessibility for people with visual or motor-control
issues.</p></div>
<div class="paragraph"><p>Here again the issues with version-control systems are relatively
minor, because all those in common use are driven by CLI tools
that are easy to script.  Mailing lists don&#8217;t present serious issues
either; the only operation on them that normally goes through the web
is moderation of submissions, and the demands of that operation are
fairly well matched to a browser-style interface.</p></div>
<div class="paragraph"><p>But there are other common operations that need to be scriptable and
are generally not. A representative one is getting a list of open bug
reports to work on later - say, somewhere that your net connection is
spotty.  There is no reason this couldn&#8217;t be handled by an email
autoresponder robot connected to the bug-tracker database, a feature
which would also improve tracker accessibility for the blind.</p></div>
<div class="paragraph"><p>Another is shipping a software release.  This normally consists of
uploading product files in various shipping formats (source tarballs,
debs, RPMs, and the like) to the hosting site&#8217;s download area, and
associating with them a bunch of metadata including such things as a
short-form release announcement, file-type or architecture tags for
the binary packages, MD5 signatures, and the like.</p></div>
<div class="paragraph"><p>With the exception of the release announcement, there is really no
reason a human being should be sitting at a web browser to type in
this sort of thing. In fact there is an excellent reason a human
<strong>shouldn&#8217;t</strong> do it by hand - it&#8217;s exactly the sort of fiddly, tedious
semi-mechanical chore at which humans tend to make (and then miss)
finger errors because the brain is not fully engaged.</p></div>
<div class="paragraph"><p>It would be better for the hosting system&#8217;s release-registration logic
to accept a job card via email, said job card including all the
release metadata and URLs pointing to the product files it should
gather for the release.  Each job card could be generated by a
project-specific script that would take the parts that really need
human attention from a human and mechanically fill in the rest. This
would both minimize human error and improve accessibility.</p></div>
<div class="paragraph"><p>In general, a good question for hosting-system designers to be asking
themselves about each operation of the system would be "Do I provide a
way to remote-script this through an email robot or XML-RPC interface
or the like?" When the answer is "no", that&#8217;s a bug that needs to be
fixed.</p></div>
</div>
<div class="sect2">
<h3 id="_poor_support_for_immigration">Poor support for immigration</h3>
<div class="paragraph"><p>The first (and in my opinion, most serious) failing I identified is
poor support for snapshotting and if necessary out-migrating a
project.  Most hosting systems do almost as badly at in-migrating a
project that already has a history, as opposed to one started from
nothing on the site.</p></div>
<div class="paragraph"><p>Even uploading an existing source code repository at start of a
project (as opposed to starting with an empty one) is only spottily
supported. Just try, for example, to find a site that will let you upload
a mailbox full of archives from a pre-existing development list in
order to re-home it at the project&#8217;s new development site.</p></div>
<div class="paragraph"><p>This is the flip side of the data-jail problem. It has some of the
same causes, and many of the same consequences too.  Because it makes
re-homing projects unnecessarily difficult, it means that project
leads cannot respond effectively to hosting-site problems.  This
creates a systemic brittleness in our development infrastructure.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_looking_deeper">Looking Deeper</h2>
<div class="sectionbody">
<div class="paragraph"><p>Why don&#8217;t existing hosting systems already have these facilities?  I
have looked into this question, actually examining the codebases of
Savane and GForge/FusionForge, and the answer appears to go back to
the original SourceForge.  It offered such exciting, cutting-edge
capabilities that nobody noticed its internal architecture was a
tar-pit full of nasty kluges.  The descendants&#8201;&#8212;&#8201;Savane, GForge, and
FusionForge&#8201;&#8212;&#8201;inherited that bad architecture.</p></div>
<div class="paragraph"><p>The central problem is implied by the implementation.  It&#8217;s PHP pages
doing SQL queries to a MySQL database.  The query logic is
inextricably tangled up with the UI.  There is no separation of
function! Now I understand why, back when I was a director at VA
Linux, the original SourceForge team promised me a scriptable release
process but never delivered.  They couldn&#8217;t have done it without
either (a) duplicating a significant number of SQL queries in some
kind of ad-hoc tool (begging for maintainance problems as the schema
changed) or (b) prying the SQL queries loose from the GUI and
isolating them in some kind of service broker, either an Apache plugin
or a service daemon, that both the web interface and a scripting tool
could call on.</p></div>
<div class="paragraph"><p>Approach (b) would have been the right thing, but would have required
re-architecting the entire system.  It never happened.  When, in my
problem statement, I complained of forge systems being excessively
tied to Web interfaces, I did not yet know how horribly true that was.</p></div>
<div class="paragraph"><p>The rottenness of the architecture also accounts, indirecctly, for
some other features of these systems that have long puzzled me - like
the reliance on cron jobs to do things like actually creating
new project instances.  The cron jobs are a half-assed substitute
for a real service broker.</p></div>
<div class="paragraph"><p>I conclude that the SourceForge/GForge/FusionForge architecture, as it
is now, is an evolutionary dead end&#8201;&#8212;&#8201;overspecialized for webbiness.
To tackle challenges like fixing the data-jail problem, scripting,
and seamless project migration, one of these systems will need to be
rebuilt from the inside out.  The surface appearance of the GUI might
survive at one end, and the SQL schema at the other, but everything&#8201;&#8212;&#8201;<strong>everything</strong>&#8201;&#8212;&#8201;between them needs to change.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_on_a_solution">Starting On A Solution</h2>
<div class="sectionbody">
<div class="paragraph"><p>Writing a new forge system to solve all these problems, and marketing
it hard enough to replace the existing ones, wouldn&#8217;t be easy. A
project that tried to do it all in one go would probably collapse from
its own overambition.</p></div>
<div class="paragraph"><p>But there is no need to tackle all of the architectural problems at
once.  An incremental path, with each stage delivering functional
tools that lay foundations for the next stage, would be better.</p></div>
<div class="paragraph"><p>The clear first step on that road is to solve the problem of
jailbreaking data out of existing forges.  That will be an essential
prerequisite for importing it into better systems, and it will build a
basis of domain knowledge on which to build those better systems.</p></div>
<div class="paragraph"><p>Just the existence of such tools would begin to sever the unhealthy
degree of coupling that presently exists between projects and their
hosting sites. It might even set off a virtuous evolutionary arms
race, with forge designers building importers in order to avoid
watching their userbases gradually migrate away from them to sites
with importers.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.0<br />
Last updated 2010-12-06 16:33:52 CET
</div>
</div>
</body>
</html>
